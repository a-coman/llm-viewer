---
const { tipo, data = {} } = Astro.props;

const getColor = (key, value) => {
  if (value === undefined || value === null || value === "") return "";

  let score = 0;
  const strVal = String(value);

  if (key === "coste") {
    const numeric = parseFloat(strVal.replace(/[^\d.]/g, "")) || 0;
    // 0€ = 1 (green), 10€ = 0 (red)
    score = Math.max(0, Math.min(1, 1 - numeric / 10));
  } else {
    if (strVal.includes("%")) {
      score = parseFloat(strVal) / 100;
    } else if (strVal.includes("/")) {
      const [n, d] = strVal.split("/").map(Number);
      score = n / d;
    } else {
      score = parseFloat(strVal) || 0;
    }
  }

  score = Math.max(0, Math.min(1, score));
  // 0-0.5 is Red (0), 0.5-1 transitions to Green (120)
  const hue = score <= 0.5 ? 0 : (score - 0.5) * 2 * 120;
  return `background-color: hsl(${hue}, 80%, 92%); font-weight: 500;`;
};
---

<div class="stats-container">
  <h2>{tipo}</h2>
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>Prop</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Cost</td>
          <td style={getColor("cost", data.cost)}>{data.cost}</td>
        </tr>
        <tr>
          <td>Syntax Success</td>
          <td style={getColor("syntax", data.syntax)}>{data.syntax}</td>
        </tr>
        <tr>
          <td>Multiplicities Success</td>
          <td style={getColor("multiplicities", data.multiplicities)}
            >{data.multiplicities}</td
          >
        </tr>
        <tr>
          <td>Invariants Success</td>
          <td style={getColor("invariants", data.invariants)}
            >{data.invariants}</td
          >
        </tr>
        <tr>
          <td>Coverage of Classes</td>
          <td style={getColor("coverage.classes", data["coverage.classes"])}
            >{data["coverage.classes"]}</td
          >
        </tr>
        <tr>
          <td>Coverage of Attributes</td>
          <td
            style={getColor("coverage.attributes", data["coverage.attributes"])}
            >{data["coverage.attributes"]}</td
          >
        </tr>
        <tr>
          <td>Coverage of Relationships</td>
          <td
            style={getColor(
              "coverage.relationships",
              data["coverage.relationships"]
            )}>{data["coverage.relationships"]}</td
          >
        </tr>
        <tr>
          <td>Instantiation of Classes</td>
          <td
            style={getColor(
              "instantiation.classes",
              data["instantiation.classes"]
            )}>{data["instantiation.classes"]}</td
          >
        </tr>
        <tr>
          <td>Instantiation of Attributes</td>
          <td
            style={getColor(
              "instantiation.attributes",
              data["instantiation.attributes"]
            )}>{data["instantiation.attributes"]}</td
          >
        </tr>
        <tr>
          <td>Instantiation of Relationships</td>
          <td
            style={getColor(
              "instantiation.relationships",
              data["instantiation.relationships"]
            )}>{data["instantiation.relationships"]}</td
          >
        </tr>
        <tr>
          <td>Realistic</td>
          <td style={getColor("realism", data.realism)}>{data.realism}</td>
        </tr>
        <tr>
          <td>Numeric Equals</td>
          <td style={getColor("numeric.equals", data["numeric.equals"])}
            >{data["numeric.equals"]}</td
          >
        </tr>
        <tr>
          <td>String Equals</td>
          <td style={getColor("string.equals", data["string.equals"])}
            >{data["string.equals"]}</td
          >
        </tr>
        <tr>
          <td>String LV</td>
          <td style={getColor("string.lv", data["string.lv"])}
            >{data["string.lv"]}</td
          >
        </tr>
      </tbody>
    </table>
  </div>
</div>

<style>
  .stats-container {
    display: inline-flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
  }

  h2 {
    font-size: 1.1rem;
    font-weight: 700;
    margin: 0;
    color: #1e293b;
    text-align: center;
  }

  .table-wrapper {
    border-radius: 0.5rem;
    border: 1px solid #e2e8f0;
    box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    overflow: hidden;
  }

  table {
    border-collapse: collapse;
    background-color: white;
  }

  thead {
    background-color: #f8fafc;
    color: #334155;
  }

  th {
    padding: 0.75rem 1rem;
    text-align: left;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-bottom: 1px solid #e2e8f0;
  }

  th:first-child {
    border-right: 1px solid #e2e8f0;
  }

  tbody {
    color: #475569;
  }

  tr {
    border-bottom: 1px solid #e2e8f0;
    transition: background-color 0.2s;
  }

  tr:last-child {
    border-bottom: none;
  }

  tr:hover {
    background-color: #f8fafc;
  }

  td {
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
  }

  td:first-child {
    font-weight: 500;
    border-right: 1px solid #e2e8f0;
  }
</style>
